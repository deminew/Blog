set :host, "linode"
set :path, "/var/www/seanhess/blog"
role :live, "linode"

desc "DB"
namespace :db do
  desc "Wipe out database"
  task :migrate, :roles => :live do 
    run "cd #{path}; rake db:migrate"
  end
  
  task :scanall, :roles => :live do
    run "cd #{path}; rake scan:all"
  end
end

namespace :rake do
  desc "Run a remote rake task"
  task :migrate, :roles => :local do 
    run "cd #{path} ; rake db:migrate"
  end
end

desc "Sync"
namespace :deploy do

  desc "Sync remote by default"
  task :default do
    remote.default
  end
  
  desc "Update the server's code"
  task :update do
    `git push origin master`
    run 'cd #{path}; git pull origin master'
  end

  namespace :remote do

      desc "Sync to remote server"
      task :default do
        tweak
        run "cd #{path}; rake scan:all"
        run "cd #{path}; rake scan:trim"
      end
      
      desc "Just changes the code"
      task :tweak do
        `rsync -avz --delete --exclude-from=.rysncignore "./" "#{host}:#{path}"`
      end
  end
end

## You don't need to even create the directory
# rsync -avz --exclude-from=.rysncignore "./" "centosnew:/home/seanhess/Blog"